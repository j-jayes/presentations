---
title: "data-ingest-for-plots"
author: "JJayes"
date: "24/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(readxl)
library(here)

df <- read_excel(here("economic-geography-reading-group", "data", "marginal-treatment-effect.xlsx"))

theme_set(theme_light())
```

```{r}
fig_mte <- df %>% 
    mutate(type = "Point estimate",
           across(c(x, y), round)) %>% 
    ggplot(aes(x, y, colour = type)) +
    geom_point() +
    geom_line() +
    geom_hline(lty = 2, aes(yintercept = 26700, colour = "Point estimate mean")) +
    scale_y_continuous(labels = scales::dollar_format()) +
    xaringanthemer::theme_xaringan() +
    scale_color_manual(values = c("#2b8cbe", "midnightblue")) +
    labs(x = "Quantile of income distribution",
         y = "Treatment effect ($)",
         colour = NULL) +
    theme(legend.position = "bottom")

df %>% write_rds(here("economic-geography-reading-group", "data", "marginal-treatment-effect-df.rds"))

# fig_mte %>% write_rds(here("economic-geography-reading-group", "data", "marginal-treatment-effect-plot.rds"))
```


```{r}
library(haven)

df <- read_stata(here("economic-geography-reading-group", "data", "house_info_location.dta")) %>% 
        mutate(destroyed = ifelse(destroyed == 1, "Destroyed", "Not destroyed"))


df %>%
  ggplot(aes(house_total_value, fill = destroyed)) +
  geom_density(alpha = .3) +
  scale_x_log10(labels = scales::dollar_format()) +
  theme_xaringan() +
  scale_fill_manual(values = c("#2b8cbe", "darkred")) +
  labs(
    x = "House value",
    y = NULL,
    fill = NULL
  ) +
  theme(legend.position = "bottom")

df %>%
  ggplot(aes(house_year, fill = destroyed)) +
  geom_density(alpha = .5) +
  scale_x_continuous(labels = scales::number_format(big.mark = "")) +
  theme_xaringan() +
  scale_fill_manual(values = c("#fc8d59", "#99d594")) +
  labs(
    x = "Year of house construction",
    y = NULL,
    fill = NULL
  ) +
    theme(legend.position = "bottom")
```


```{r}
df %>% 
    ggplot(aes(longitude, latitude, colour = house_year, shape = destroyed)) +
    geom_point() +
    scale_color_gradient2(low = "#fc8d59",
                          high = "#99d594",
                          mid = "#ffffbf",
                          midpoint = 1935) +
    theme_xaringan() +
    labs(x = NULL,
         y = NULL,
         colour = "Year of construction",
         shape = NULL) +
    theme(legend.position = "bottom",
          panel.grid = element_blank(),
          axis.text = element_blank()) +
    guides(shape = guide_legend(nrow = 2),
           colour = guide_colorbar(barwidth = 20,
                                   title.position = "top"))

df %>%
  ggplot(aes(longitude, latitude, colour = house_total_value, shape = destroyed)) +
  geom_point() +
  scale_color_gradient2(
    low = "blue",
    high = "red",
    mid = "pink",
    midpoint = log10(40000),
    trans = "log10",
    labels = scales::dollar_format()
  ) +
    scale_shape_manual(values = c(19, 17)) +
    theme_xaringan() +
  labs(
    colour = "House value",
    shape = NULL,
    x = NULL,
    y = NULL
  ) +
    theme(legend.position = "bottom",
          panel.grid = element_blank(),
          axis.text = element_blank()) +
    guides(shape = guide_legend(nrow = 2),
           colour = guide_colorbar(barwidth = 20,
                                   title.position = "top"))
```


```{r}
df %>% 
    ggplot(aes(longitude, latitude, colour = house_total_value)) +
    geom_point() +
    scale_color_gradient2(low = "blue",
                          high = "red",
                          mid = "pink",
                          midpoint = log10(40000),
                          trans = "log10",
                          labels = scales::dollar_format()) +
    facet_wrap(~ destroyed,
               nrow = 2) +
    labs(fill = "House value")


```

```{r}
df %>% 
    ggplot(aes(longitude, latitude, colour = house_total_value, shape = destroyed)) +
    geom_point() +
    scale_color_gradient2(low = "blue",
                          high = "red",
                          mid = "pink",
                          midpoint = log10(40000),
                          trans = "log10",
                          labels = scales::dollar_format()) +
    # scale_shape_manual(values = c(11, 19)) +
    theme_xaringan() +
    labs(colour = "House value",
         shape = NULL,
         x = NULL,
         y = NULL) +
    theme(panel.grid = element_blank(),
          axis.text = element_blank(),
          axis.ticks = element_blank())
    
```
